(function(){A.uicss("calendar/calendar.css");A.ui.calendar=function(b){return new a(b)};function a(g){var c=function(){},d=this;var b=new Date();b=[b.getFullYear(),b.getMonth()+1,b.getDate()];var e=document.createElement("div");if(g.element){this.G(g.element).appendChild(e)}else{document.body.appendChild(e)}this.op={element:g.element,date:g.date||b,today:g.today||b,count:g.count||1,between:g.between||[0,99999999],input:this.G(g.input)||null,position:this.G(g.position),onStart:g.onStart||c,onShow:g.onShow||c,onHide:g.onHide||c,onSelectDay:g.onSelectDay||c,onChange:g.onChange||c,toInput:g.toInput,formInput:g.formInput};this.cache={cal:e,input:this.op.input,position:this.op.position||this.op.input,date:this.date(this.op.date),cur_date:[0,0,1],count:this.op.count,between:this.op.between,iframeHeight:null,iframeWidth:null,cells:[],heads:[],btns:[]};if(this.cache.input){this.addEvent(document.body,"click",function(f){d.hide()});this.addEvent(this.cache.cal,"click",function(f){return false},true);var c=function(){if(d.op.formInput){d.op.formInput.call(d,d.cache.input)}else{d.formInput.call(d,d.cache.input)}};d.addEvent(d.cache.input,["click"],c,true);this.hide()}this.op.onStart.call(this,this.cache.cal);this.initHtml()}a.prototype={conf:{day_text:["日","一","二","三","四","五","六"],cal_text:["年","月","日"],cal_class:"opui-calendar-cal",month_class_pre:"opui-calendar-mon_pre",month_class:"opui-calendar-mon",day_class:["opui-calendar-mon_pre_month","opui-calendar-mon_cur_month","opui-calendar-mon_next_month","opui-calendar-mon_today","opui-calendar-mon_day_hover","opui-calendar-mon_day_selected","opui-calendar-mon_day_disabled"],btn_class:["opui-calendar-btn_pre_month","opui-calendar-btn_next_month"]},IE:/msie/.test(navigator.userAgent.toLowerCase())&&!/opera/.test(navigator.userAgent.toLowerCase()),G:function(b){if(typeof b=="string"){return document.getElementById(b)}return b},hasClass:function(c,b){var e=c.className.split(/s+/);for(var d=0;d<e.length;d++){if(b==e[d]){return true}}return false},addClass:function(c,b){if(!this.hasClass(c,b)){if(c.className==""){c.className=b}else{c.className+=" "+b}}},removeClass:function(c,b){var e=c.className.split(/\s+/);for(var d=0;d<e.length;d++){if(b==e[d]){e.splice(d,1)}}c.className=e.join(" ")},each:function(e,d){for(var c=0,b=e.length;c<b;c++){d.apply(e[c],[c,e[c]])}},addEvent:function(g,d,e,b){var h=function(f){f=window.event||f;if(b){if(f.stopPropagation){f.stopPropagation()}else{f.cancelBubble=true}}e.call(g,f)};var c=[].concat(d);this.each(c,function(j,f){if(document.attachEvent){g.attachEvent("on"+f,h)}else{g.addEventListener(f,h,false)}})},days:function(w){w=this.date(w);var n,o,x,e,v,t,b,u,p,h,g=[[],[],[]];n=w[0];o=w[1];t=new Date(n,o-1,0);b=new Date(n,o,0);u=new Date(n,o,1);p=b.getDate();x=t.getMonth()+1;e=t.getDate();v=u.getMonth()+1;n=b.getFullYear();o=b.getMonth()+1;var d=t.getFullYear(),c=u.getFullYear();for(var s=t.getDay();s>=0;s--,e--){g[0].unshift([d,f(x),f(e)].join(""))}for(var s=1;s<=p;s++){g[1].push([n,f(o),f(s)].join(""))}for(var s=1,r=b.getDay(),q=(g[0].length+g[1].length<36)?14-r:7-r;s<q;s++){g[2].push([c,f(v),f(s)].join(""))}return g;function f(i){return("0"+i).slice(-2)}},date:function(b){if(typeof b=="string"||typeof b=="number"){b=b.toString().match(/^(\d+)(\d\d)(\d\d)$/);b.shift()}var c=new Date(b[0],b[1]-1,b[2]);return[c.getFullYear(),c.getMonth()+1,c.getDate()]},initHtml:function(){var g=['<iframe src="about:blank" frameborder="0" marginheight="0" marginwidth="0" scrolling="no" style="position:absolute;z-index:-1;left:0;top:0;width:1;height:1;"></iframe><table cellspacing="0" class="',this.conf.cal_class,'"><tr>'];for(var f=0;f<this.cache.count;f++){g.push('<td class="',this.conf.month_class_pre,f+1,'">','<div class="',this.conf.month_class,'"><h5>',f==0?('<span class="'+this.conf.btn_class[0]+'"></span>'):"",f==(this.cache.count-1)?('<span class="'+this.conf.btn_class[1]+'"></span>'):"",'<strong></strong></h5><table width="100%" cellspacing="0"><tr>');for(var b=0;b<7;b++){g.push("<th>",this.conf.day_text[b],"</th>")}g.push("</tr>");for(var e=0;e<6;e++){g.push("<tr>");for(var d=0;d<7;d++){g.push('<td week="',d,'"></td>')}g.push("</tr>")}g.push("</table></div></td>")}g.push("</tr></table>");var h=this.cache;h.cal.innerHTML=g.join("");this.each(h.cal.getElementsByTagName("td"),function(c,j){if(j.getAttribute("week")){h.cells.push(j)}});this.each(h.cal.getElementsByTagName("strong"),function(j,c){h.heads.push(c)});this.each(h.cal.getElementsByTagName("span"),function(c,j){h.btns.push(j)});this.setHtml(this.cache.date.concat());this.setEvent()},setHtml:function(g){var r=[],s=0,q=this.cache,d=this;g=this.date(g);q.cur_date[0]=g[0];q.cur_date[1]=g[1];var e=d.date(d.op.today);e=""+e[0]+("0"+e[1]).slice(-2)+("0"+e[2]).slice(-2);for(var p=0;p<q.count;p++){r.push(this.days([q.cur_date[0],q.cur_date[1]+p,1]))}for(var n=0;n<q.count;n++){var b=r[n][1][0].toString().match(/^(\d+)(\d\d)(\d\d)$/);q.heads[n].innerHTML=b[1]+d.conf.cal_text[0]+b[2]+d.conf.cal_text[1];for(var l=0;l<3;l++){for(var f=0;f<r[n][l].length;f++){var h=q.cells[s];h.innerHTML=r[n][l][f].toString().slice(-2)-0;h.setAttribute("date",r[n][l][f].toString());h.className=this.conf.day_class[l];if(r[n][l][f]==e){d.addClass(h,d.conf.day_class[3])}if(r[n][l][f]<q.between[0]||r[n][l][f]>q.between[1]){d.addClass(h,d.conf.day_class[6])}s++}}}this.op.onChange.call(this)},setEvent:function(){var b=this.conf.day_class;var d=this;var c={normal:{mouseover:function(){d.addClass(this,b[4])},mouseout:function(){d.removeClass(this,b[4])},click:function(f,g){if(d.cache.selected){d.removeClass(d.cache.selected,b[5])}d.cache.selected=this;d.addClass(this,b[5]);if(d.cache.input){if(d.op.toInput){d.op.toInput.call(d,f,g)}else{d.toInput.call(d,f,g)}}d.op.onSelectDay.call(d,f,g)}},disable:{mouseover:function(){return false},mouseout:function(){return false},click:function(f,g){return false}},btn:{0:function(){d.preMonth()},1:function(){d.nextMonth()}}};this.each(this.cache.btns,function(g,f){f.onclick=function(){c.btn[g].call(f)}});this.each(this.cache.cells,function(f,g){g.onmouseover=function(){c[e(g)].mouseover.call(g)};g.onmouseout=function(){c[e(g)].mouseout.call(g)};g.onclick=function(){var h=g.getAttribute("date")-0,i=g.getAttribute("week")-0;c[e(g)].click.call(g,h,i)}});function e(g){var f=g.getAttribute("date")-0;return(f<=d.cache.between[1]&&f>=d.cache.between[0])?"normal":"disable"}},show:function(){this.cache.cal.style.display="block";var g=this.cache;if(g.input){var b={position:"absolute",zIndex:"10"};var d=g.position,j=d.offsetLeft,h=d.offsetTop+d.offsetHeight;while((d=d.offsetParent)){var l=k(d,"position");if(l=="relative"||l=="absolute"){break}j+=d.offsetLeft;h+=d.offsetTop}b.left=j+"px";b.top=h+1+"px";for(var f in b){g.cal.style[f]=b[f]}g.iframeHeight=this.cache.cal.offsetHeight;g.iframeWidth=this.cache.cal.offsetWidth;var e=g.cal.getElementsByTagName("iframe")[0];e.style.height=g.iframeHeight+"px";e.style.width=g.iframeWidth+"px"}this.op.onShow.call(this,this.cache.cal);function k(i,c){if(i.currentStyle){return i.currentStyle[c]}else{return document.defaultView.getComputedStyle(i,null)[c]}}},hide:function(){this.cache.cal.style.display="none";this.op.onHide.call(this,this.cache.cal)},nextMonth:function(){this.cache.cur_date[1]++;this.setHtml(this.cache.cur_date)},preMonth:function(){this.cache.cur_date[1]--;this.setHtml(this.cache.cur_date)},nextYear:function(){this.cache.cur_date[0]++;this.setHtml(this.cache.cur_date)},preYear:function(){this.cache.cur_date[0]--;this.setHtml(this.cache.cur_date)},setBetween:function(c){this.cache.between=c;this.setHtml(this.cache.cur_date)},isCurMonth:function(b){var b=this.date(b);if(this.cache.cur_date[0]==b[0]&&this.cache.cur_date[1]==b[1]){return true}return false},setDay:function(d,f){var h=null;d=[].concat(d);this.each(d,function(k,j){d[k]=j.toString()});var g=this.cache.cells;for(var e=0,b=g.length;e<b;e++){for(var c=0;c<d.length;c++){if(g[e].getAttribute("date")==d[c]){if(this.hasClass(g[e],this.conf.day_class[1])){h=g[e];this.addClass(h,"opui-calendar-cell_seledted")}}}}},toInput:function(c,d){var b=this.cache.input;c=c.toString().match(/^(\d+)(\d\d)(\d\d)$/);var e=c[1]+"-"+c[2]+"-"+c[3]+"(周"+this.conf.day_text[d]+")";if(b.tagName.toLowerCase()=="input"){b.value=e}else{b.innerHTML=e}this.hide()},formInput:function(b){var e,f=this.cache;if(b.tagName.toLowerCase()=="input"){e=b.value}else{e=b.innerHTML}var d=e.match(/^(\d+)-(\d\d)-(\d\d)/);if(d&&d.length==4){d.shift();if(!this.isCurMonth(d)){this.setHtml(d)}}this.show()}}})();